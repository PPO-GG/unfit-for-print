<template>
  <div class="">
	  <div class="px-4 py-8 flex flex-col items-center text-center">
		  <svg
				  class="text-white mx-auto mb-4 w-full max-w-[300px] h-auto"
				  xmlns="http://www.w3.org/2000/svg"
				  viewBox="0 0 920.08 767.72"
				  stroke="black"
				  stroke-width="5px"
				  stroke-miterlimit="10"
		  ><path fill="currentColor" d="M105.27,251.59C20.08,254.43,5.12,213.52,2.19,145.29c-.32-7.53-.53-16.92-.75-27.12-.07-3.15-.14-6.42-.26-11.31C.48,76.96.4,47.04,0,17.12.4-4.33,10.44,1.01,31.41.61c10.58-.2,31.54-3.05,35.98,7.13,2.86,6.58.19,26.37.06,34.89-.31,20.96.61,42.11,1.12,63.08.07,2.95.17,7.3.26,11.55.19,8.98.38,17.26.75,25.97,1.27,29.58,5.99,44.19,35.7,48.37,29.71-4.18,34.43-18.79,35.7-48.37.37-8.71.55-16.98.75-25.97.09-4.24.19-8.6.26-11.55.77-29.4,2.15-54.92-.3-84.52C139.86-.81,147.13.22,170.17.17c7.74-.02,35.38-1.52,39.72,4.78,2.67,3.88.55,24.76.5,30.59-.21,23.86-.45,47.46-1.02,71.33-.12,4.9-.19,8.16-.26,11.31-.22,10.2-.43,19.59-.75,27.12-2.93,68.22-17.9,109.14-103.09,106.3Z"/>
				<path fill="currentColor" d="M347.23,247.67c-5.8-5.44-12.09-21.61-15.79-29.26-3.94-8.15-31.18-66.13-33.71-68.36-2.36-2.08-1.63,12.87-1.62,13.65.32,23.14.01,45.94.67,69.12.6,20.94-6.75,19.06-28.32,18.52-9.3-.23-33.94,1.63-40.44-2.27-7.28-4.36-4.51-21.91-4.41-29.35.74-59.43.4-119.66.08-179.13-.04-7.25-1.79-29.74.75-34.74,4.14-8.15,24.38-5.16,33.39-4.91,6.74.18,33.57-.72,37.31.21,7.42,1.84,12.19,16.95,14.84,22.74,11.75,25.62,24.85,51.57,37.2,77.06,0-28.53-.15-56.98-.27-85.5-.01-2.66.25-10.96,2.8-12.73,4.3-2.99,35.17-1.86,42.49-2.11,28.46-.94,28.97,2.97,27.96,27.26-1.13,27.12-.34,56.24-.34,83.57,0,41.09-.16,82.09.41,123.17.26,19.4-8.48,17.21-28.17,16.69-10.41-.28-35.65,1.73-43.25-2.59l-1.57-1.04Z"/>
				<path fill="currentColor" d="M435.89,157.69v-93.22c0-14.6.04-28.74-.5-43.35-.83-22.83,7.35-20.79,30.72-20.21,33.85.85,69.54.2,103.58.21,7.61,0,34.56-1.03,39.6.35,10.71,2.93,8.08,18.34,7.89,25.87-.18,7.07,1.4,27.33-1.34,32.3-4.14,7.51-23.41,5.12-31.89,4.97-18.38-.34-36.29.03-54.76-.58-16.25-.54-22.5,2.3-21.92,17.68.55,14.55,10.72,13.27,24.41,12.92,14.15-.37,28.7-.45,42.9-.63,17.7-.22,16.83,6.38,16.46,20.39-.26,9.69-.1,17.88.15,27.53.46,17.8-7.44,16.61-25.96,16.18-8.71-.2-43.72-1.58-49.57-.28-7.08,1.58-7.33,6.05-7.59,11.93-.48,10.96.45,24.24.45,35.61,0,7.13,1.16,34.71-.19,39.19-2.01,6.67-8.75,6.74-15.71,6.82-11.51.13-21.98-.41-33.83,0-23.06.79-23.96-3.67-23.26-22.93.85-23.26.35-47.38.35-70.73Z"/>
				<path fill="currentColor" d="M623.9,246.76c-4.86-7.69-2.36-26.09-2.31-35.4.35-59.52.29-119.5,0-179.03-.03-6.83-2.25-23.94,3.03-28.54,5.88-5.12,30.18-2.73,39.22-2.84,8.66-.1,25.56-2.81,29.36,5.25,2.51,5.32,1.03,32.89,1.03,40.71,0,57.45-.61,115.4.03,172.79.08,7.38,3.07,25.43-4.24,29.54-6.64,3.73-28.96,1.73-38.1,1.92-8.86.18-21.69,2.36-28.02-4.4Z"/>
				<path fill="currentColor" d="M842.73,1.12c14.38,0,28.98-.43,43.2-.39,19.45.06,17.02,8.09,16.46,22.63-.3,7.61,1.17,31.06-1.21,36.21-3.62,7.83-19.95,5.09-27.59,4.87-7.49-.21-27.22-2.22-31.5,3.62-3.56,4.86-1.75,24.64-1.75,31.62.03,39.89-.58,80.39.06,120.2.11,7.01,2.79,25.47-4.14,29.47-8.14,3.55-30.98,1.92-41.5,2.15-30.47.69-28.23-5.58-27.35-30.11,1-27.63.33-56.79.42-84.6.06-19.38.14-38.75.21-58.13.05-14.38-2.75-14.91-19.04-14.46-7.28.2-36.23,2.15-40.84-1.67-4.09-3.39-2.23-23.03-2.3-28.76-.08-6.95-2.89-27.68,4.05-31.27,5.29-2.73,28.89-1.4,36.39-1.4,32.14,0,64.27,0,96.41,0Z"/>
				<path fill="currentColor" d="M3.09,486.44c.85-23.25.35-47.38.35-70.73v-93.22c0-14.6.04-28.74-.5-43.35-.83-22.83,7.35-20.79,30.72-20.21,33.85.85,69.54.2,103.58.21,7.61,0,34.56-1.03,39.6.35,10.71,2.93,8.08,18.34,7.89,25.87-.18,7.07,1.4,27.33-1.34,32.3-4.14,7.51-23.41,5.12-31.89,4.97-18.37-.34-36.29.03-54.76-.58-16.25-.54-22.5,2.3-21.92,17.68.55,14.55,10.72,13.27,24.41,12.92,14.15-.37,28.7-.45,42.9-.63,17.7-.22,16.83,6.38,16.46,20.39-.26,9.7-.1,17.88.15,27.53.46,17.8-7.44,16.61-25.96,16.18-8.71-.2-43.72-1.58-49.57-.28-7.08,1.58-7.33,6.05-7.6,11.93-.48,10.96.45,24.24.45,35.62,0,7.13,1.16,34.71-.19,39.19-2.01,6.67-8.75,6.74-15.71,6.82-11.51.13-21.98-.41-33.83,0-23.06.79-23.96-3.67-23.26-22.92h0Z"/>
				<path fill="currentColor" d="M181.49,366.37c-3.53-142.98,259.65-142.98,256.13,0-1.23,50.11-4.06,83.46-28.03,108.21-44.35,45.79-155.71,45.79-200.06,0-23.97-24.75-26.8-58.1-28.03-108.21ZM248.88,365.24c.93,37.66,2.37,62.02,12.44,72.42,15.22,15.71,81.25,15.71,96.47,0,10.07-10.4,11.51-34.76,12.44-72.42,1.5-60.84-122.85-60.84-121.35,0Z"/>
				<path fill="currentColor" d="M652.52,336.33c.43,27.81-10,50.55-37.92,65.44-15.03,8.01-22.54,5.1-14.08,21.66,10.67,20.86,20.35,42.24,31.16,62.92,2.23,4.26,12.01,18.58,4.78,21.82-4.34,1.94-31.44.84-38.73,1-19.81.43-27.66,2.31-35.61-14.96-8.02-17.42-16.25-34.29-24.53-51.58-1.14-2.37-12.01-30.26-17.52-21.63-2.41,3.78-1.19,59.01-.93,67.5.5,15.99,1.72,21.33-18.36,20.99-12.69-.22-23.69-.2-36.34-.08-15.71.14-18.82-.82-18.59-14.7.91-54.22.38-108.48.38-162.7,0-18.45-.21-36.21-.61-54.65-.5-22.89,13.37-17.78,31.84-18.64,23.91-1.11,41.98-1.84,66.32.58,53.48,5.33,105.56,23.47,108.75,77.04ZM584.93,339.34c0-19.32-36.23-23.39-66.06-23.47v45.66c26.78,1.01,66.06-1.09,66.06-22.19Z"/>
				<path fill="currentColor" d="M76.14,717.32c0,8.23,1.24,37.56-.28,43.17-1.85,6.81-8.33,6.99-15.44,7.02-11.47.05-22.17-.39-33.94-.14-27.74.57-23.61-5.16-23.05-27.39.75-30.1.1-61.44.1-91.67,0-38.3.02-76.49-.34-114.79-.2-21,12.64-16.03,30.63-16.73,17.53-.68,30.82-1.61,48.9-.79,64.11,2.92,135.4,23.44,126.49,92.05-7.08,54.55-67.95,68.31-121.2,69.67-4.35.11-8.68-.04-10.87,3.5-2.4,6.71-.98,27.67-.98,36.11ZM76.15,619.56c26.78,1.01,66.06-1.09,66.06-22.19,0-19.32-36.23-23.39-66.06-23.47v45.66Z"/>
				<path fill="currentColor" d="M420.46,594.35c.43,27.81-10,50.55-37.92,65.44-15.03,8.01-22.54,5.1-14.08,21.66,10.67,20.86,20.35,42.24,31.16,62.92,2.23,4.26,12.01,18.58,4.78,21.82-4.34,1.94-31.44.84-38.73,1-19.81.43-27.66,2.31-35.61-14.96-8.02-17.42-16.25-34.29-24.53-51.58-1.14-2.37-12.01-30.26-17.52-21.63-2.41,3.78-1.19,59.01-.93,67.5.5,15.99,1.72,21.33-18.36,20.99-12.69-.22-23.69-.2-36.34-.08-15.71.14-18.82-.82-18.59-14.7.91-54.22.38-108.48.38-162.7,0-18.45-.21-36.21-.61-54.65-.5-22.89,13.37-17.78,31.84-18.64,23.91-1.11,41.98-1.84,66.32.58,53.48,5.33,105.56,23.47,108.74,77.04ZM352.87,597.36c0-19.32-36.23-23.39-66.06-23.47v45.66c26.78,1.01,66.06-1.09,66.06-22.19Z"/>
				<path fill="currentColor" d="M428.87,762.8c-4.86-7.69-2.36-26.09-2.31-35.4.35-59.52.29-119.5,0-179.03-.03-6.83-2.25-23.94,3.02-28.54,5.88-5.12,30.18-2.73,39.22-2.84,8.66-.1,25.56-2.81,29.36,5.25,2.51,5.33,1.03,32.89,1.03,40.71,0,57.45-.61,115.4.03,172.79.08,7.38,3.07,25.43-4.24,29.54-6.64,3.73-28.96,1.73-38.1,1.92-8.86.18-21.69,2.36-28.02-4.4Z"/>
				<path fill="currentColor" d="M638.96,763.71c-5.8-5.44-12.09-21.61-15.79-29.26-3.94-8.15-31.18-66.13-33.71-68.36-2.36-2.08-1.63,12.87-1.62,13.65.32,23.14.01,45.94.67,69.12.59,20.94-6.75,19.06-28.32,18.52-9.3-.24-33.94,1.63-40.44-2.27-7.28-4.37-4.51-21.91-4.41-29.35.74-59.43.4-119.66.08-179.13-.04-7.25-1.79-29.74.75-34.74,4.14-8.16,24.38-5.16,33.39-4.91,6.74.18,33.57-.72,37.32.21,7.42,1.84,12.18,16.95,14.84,22.74,11.75,25.62,24.85,51.57,37.2,77.06,0-28.53-.15-56.98-.27-85.5-.01-2.66.25-10.96,2.8-12.73,4.3-2.99,35.17-1.87,42.49-2.11,28.46-.94,28.97,2.97,27.96,27.26-1.13,27.12-.34,56.24-.34,83.57,0,41.09-.16,82.09.41,123.17.26,19.4-8.48,17.21-28.17,16.69-10.41-.28-35.65,1.73-43.25-2.59l-1.57-1.04Z"/>
				<path fill="currentColor" d="M860.02,517.16c14.38,0,28.98-.43,43.2-.39,19.45.06,17.02,8.09,16.46,22.63-.3,7.61,1.17,31.06-1.21,36.21-3.62,7.83-19.95,5.08-27.59,4.87-7.49-.21-27.22-2.22-31.5,3.62-3.56,4.86-1.75,24.64-1.75,31.62.03,39.89-.58,80.39.06,120.2.11,7.01,2.79,25.47-4.14,29.47-8.14,3.55-30.98,1.92-41.5,2.15-30.47.69-28.23-5.58-27.35-30.11,1-27.63.33-56.79.42-84.6.06-19.38.14-38.75.21-58.13.05-14.38-2.75-14.91-19.04-14.46-7.28.2-36.23,2.16-40.84-1.67-4.09-3.39-2.23-23.03-2.3-28.76-.08-6.95-2.89-27.68,4.05-31.27,5.29-2.73,28.89-1.4,36.39-1.4,32.14,0,64.27,0,96.41,0Z"/>
			</svg>
		  <p class="font-['Bebas_Neue'] text-white text-xl md:text-2xl select-none max-w-xs sm:max-w-md">
			  A PARTY GAME FOR HIDEOUS PEOPLE
		  </p>
		</div>
    <div class="flex justify-center gap-6">
	    <div class="outline-2 outline-dashed outline-gray-300/25 outline-offset-4 rounded-xl">
	      <BlackCard
	          v-if="blackCard"
	          @click="blackCardFlipped = !blackCardFlipped"
	          :card-id="blackCard.$id"
	          :text="blackCard.text"
	          :cardPack=blackCard.pack
	          :flipped="blackCardFlipped"
	          :threeDeffect="threeDeffect"
	          :num-pick="randomCard.pick"
	          :shine="shine"
	          :back-logo-url="'/img/ufp.svg'"
	          :mask-url="'/img/textures/hexa.png'"
	      />
		    <div v-else class="flex items-center p-2 text-white mt-4 w-40 sm:w-48 md:w-56 lg:w-64 xl:w-72 aspect-[3/4] bg-[#1c2342] rounded-xl border-6 border-slate-800">
			    <div class="grid gap-2">
				    <USkeleton class="h-4 w-[250px] bg-slate-600/50" />
				    <USkeleton class="h-4 w-[200px] bg-slate-600/50" />
			    </div>
		    </div>
		  </div>

      <div class="outline-2 outline-dashed outline-gray-300/25 outline-offset-4 rounded-xl">
        <WhiteCard
            v-if="whiteCard"
            @click="whiteCardFlipped = !whiteCardFlipped"
            :card-id="whiteCard.$id"
            :text="whiteCard.text"
            :card-pack="whiteCard.pack"
            :flipped="whiteCardFlipped"
            :three-deffect="threeDeffect"
            :shine="shine"
            :back-logo-url="'/img/ufp.svg'"
            :mask-url="'/img/textures/hexa2.png'"
        />
	      <div v-else class="flex items-center p-2 text-white mt-4 w-40 sm:w-48 md:w-56 lg:w-64 xl:w-72 aspect-[3/4] bg-[#e7e1de] rounded-xl border-6 border-stone-400/50">
		      <div class="grid gap-2">
			      <USkeleton class="h-4 w-[250px] bg-stone-400/50" />
			      <USkeleton class="h-4 w-[200px] bg-stone-400/50" />
		      </div>
	      </div>
      </div>
    </div>
	  <div class="flex flex-col items-center mt-8">
		  <UButtonGroup>
		  <UButton
				  loading-auto
				  @click="fetchNewCards"
				  class="text-xl py-2 px-4 cursor-pointer font-['Bebas_Neue']" color="secondary" variant="subtle" icon="i-solar-layers-minimalistic-bold-duotone"
		  >
			  TRY ME
		  </UButton>
		  <UButton
				  loading-auto
				  @click="speak(mergeCardText(blackCard.text, whiteCard.text))"
				  class="text-xl py-2 px-4 cursor-pointer font-['Bebas_Neue']" color="primary" variant="subtle" icon="i-solar-user-speak-bold-duotone"
		  />
		  </UButtonGroup>
	  </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import {useCards} from "~/composables/useCards";
import { useVibrate } from '@vueuse/core'
import { useSpeech } from '~/composables/useSpeech'
import { mergeCardText } from '~/composables/useMergeCards'

const {speak} = useSpeech('NuIlfu52nTXRM2NXDrjS')


// import { isMobile, isDesktop, isChromium, isFirefox } from '@basitcodeenv/vue3-device-detect'

const { vibrate, stop, isSupported } = useVibrate({ pattern: [10, 7, 5] })
useHead({
  title: `Unfit for Print`,
})

const whiteCard = ref<any>(null);
const blackCard = ref<any>(null);

const blackCardFlipped = ref(true);
const whiteCardFlipped = ref(true);
const threeDeffect = ref(true);
const shine = ref(true);
const {fetchRandomWhiteCard, fetchRandomBlackCard} = useCards();
const randomCard = ref<any>({ pick: 1 }); // Initialize with default pick value
const {playSfx} = useSfx();
const { notify } = useNotifications()

const fetchNewCards = async () => {
	whiteCardFlipped.value = true;
	blackCardFlipped.value = true;
	await playSfx('/sounds/sfx/submit.wav',{ pitch: [0.8, 1.2], volume: 0.75});
  return new Promise<void>(res => setTimeout(res, 1000)
  ).then(() => {
	  vibrate()
    // Use default card pack for random cards
    const defaultCardPacks = ['CAH Base Set', 'CAH: Blue Box Expansion'];
    fetchRandomWhiteCard().then((card: any) => {
      whiteCard.value = card;
	    whiteCardFlipped.value = false;
    });
   fetchRandomBlackCard(1).then((card: any) => {
      blackCard.value = card;
      randomCard.value = card; // Store the card in randomCard.value as well
	    blackCardFlipped.value = false;
    });
    notify({
      title: 'Fetched New Cards',
      icon: "i-mdi-cards",
      color: 'info',
      duration: 1000,
    })
  });
};

onMounted(() => {
		if (import.meta.client) {
			fetchNewCards()
			notify({
				title: 'Fetched New Cards',
				icon: "i-mdi-cards",
				color: 'info',
				duration: 1000,
			})
		}
});
</script>
